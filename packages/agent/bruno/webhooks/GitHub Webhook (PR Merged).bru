meta {
  name: GitHub Webhook (PR Merged)
  type: http
  seq: 1
}

post {
  url: {{baseUrl}}/webhooks/github
  body: json
  auth: none
}

headers {
  X-GitHub-Event: pull_request
}

body:json {
  {
    "action": "closed",
    "pull_request": {
      "number": 42,
      "title": "Integrate: feature/auth",
      "merged": true,
      "merge_commit_sha": "abc123def456",
      "head": {
        "ref": "integration/feature/auth"
      },
      "base": {
        "ref": "main"
      },
      "html_url": "https://github.com/org/repo/pull/42"
    }
  }
}

docs {
  ## GitHub Webhook (PR Merged)

  Simula un webhook de GitHub cuando un PR de integración se mergea.

  El Pipeline Service:
  1. Verifica que sea un PR mergeado (`action: closed` + `merged: true`)
  2. Verifica que sea una rama de integración (`integration/...`)
  3. Emite evento `integration.pr.merged`
  4. Mueve la rama de `pending_merge` a `merge_history` en el manifest
  5. Limpia ramas `pipeline/` e `integration/`

  **Nota:** Si `webhook_secret` está configurado, necesitas el header
  `X-Hub-Signature-256` con el HMAC-SHA256 del body.
}
