meta {
  name: GitHub Webhook (Changes Requested)
  type: http
  seq: 4
}

post {
  url: {{baseUrl}}/webhooks/github
  body: json
  auth: none
}

headers {
  X-GitHub-Event: pull_request_review
}

body:json {
  {
    "action": "submitted",
    "review": {
      "state": "changes_requested",
      "body": "Please add error handling for the login endpoint and fix the type mismatch on line 42.",
      "user": {
        "login": "reviewer123"
      }
    },
    "pull_request": {
      "number": 99,
      "head": {
        "ref": "agent/issue-42-add-login"
      }
    },
    "repository": {
      "full_name": "org/repo"
    }
  }
}

docs {
  ## GitHub Webhook (Changes Requested)

  Simulates a `pull_request_review` webhook when a reviewer requests changes.

  The reaction engine will:
  1. Match the PR branch to an active session
  2. Emit `session.changes_requested` event with review comments
  3. If `reactions.changes_requested.action` is `respawn_agent`,
     re-run the agent with review feedback as context
}
