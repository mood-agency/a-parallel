meta {
  name: GitHub Webhook (CI Failed)
  type: http
  seq: 2
}

post {
  url: {{baseUrl}}/webhooks/github
  body: json
  auth: none
}

headers {
  X-GitHub-Event: check_suite
}

body:json {
  {
    "action": "completed",
    "check_suite": {
      "conclusion": "failure",
      "head_branch": "agent/issue-42-add-login",
      "head_sha": "abc123",
      "pull_requests": [
        {
          "number": 99,
          "head": {
            "ref": "agent/issue-42-add-login"
          }
        }
      ]
    },
    "repository": {
      "full_name": "org/repo"
    }
  }
}

docs {
  ## GitHub Webhook (CI Failed)

  Simulates a GitHub `check_suite` webhook when CI fails on an issue branch.

  The reaction engine will:
  1. Match the branch to an active session
  2. Emit `session.ci_failed` event
  3. If `reactions.ci_failed.action` is `respawn_agent`, re-run the agent
     with CI failure logs injected as context
}
