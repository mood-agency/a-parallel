#!/bin/sh
# Husky pre-commit hook

# Secret detection
git diff --cached --name-only --diff-filter=ACM | grep -v '^docker/' | xargs -r npx secretlint

# Lint staged JS/TS files
git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | xargs -r npx oxlint

# Format staged files (auto-fix and re-stage)
STAGED_FMT=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|css|json)$')
if [ -n "$STAGED_FMT" ]; then
  echo "$STAGED_FMT" | xargs npx oxfmt --write
  echo "$STAGED_FMT" | xargs git add
fi
