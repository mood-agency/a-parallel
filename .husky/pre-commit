#!/bin/sh
# Husky pre-commit hook

# Secret detection
git diff --cached --name-only --diff-filter=ACM | grep -v '^docker/' | xargs -r npx secretlint

# Format staged files (auto-fix and re-stage) â€” run BEFORE lint so format issues never block
STAGED_FMT=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|css|json)$' | grep -v '^\.claude/' || true)
if [ -n "$STAGED_FMT" ]; then
  echo "$STAGED_FMT" | xargs npx oxfmt --write
  echo "$STAGED_FMT" | xargs git add
fi

# Lint staged JS/TS files (runs after format so code is already clean)
git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | xargs -r npx oxlint
